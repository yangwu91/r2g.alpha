name: Run a quick test using Conda

on:
  push

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Install r2g by Conda ans run a quick test
      env:
        NAME: r2g.dev
        PRIVATE_WEBDRIVER: ${{ secrets.PRIVATE_WEBDRIVER }}
      run : |
        wget -qO miniconda3.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
        bash miniconda3.sh -bfp /opt/miniconda3
        /opt/miniconda3/bin/conda config --add channels defaults
        /opt/miniconda3/bin/conda config --add channels bioconda
        /opt/miniconda3/bin/conda config --add channels conda-forge
        /opt/miniconda3/bin/conda install yangwu91/${NAME}
        mkdir -p "${HOME}"/.ncbi
        cat > "${HOME}"/.ncbi/user-settings.mkfg <<_EOF
        ## auto-generated configuration file - DO NOT EDIT ##

        /LIBS/GUID = "$(uuidgen)"
        /config/default = "false"
        /repository/user/ad/public/apps/file/volumes/flatAd = "."
        /repository/user/ad/public/apps/refseq/volumes/refseqAd = "."
        /repository/user/ad/public/apps/sra/volumes/sraAd = "."
        /repository/user/ad/public/apps/sraPileup/volumes/ad = "."
        /repository/user/ad/public/apps/sraRealign/volumes/ad = "."
        /repository/user/ad/public/root = "."
        /repository/user/default-path = "${HOME}/ncbi"

        _EOF
        /opt/miniconda3/bin/r2g --dry-run
